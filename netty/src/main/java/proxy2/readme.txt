在实现代理网关之前，首先介绍下代理相关的原理及如何实现

透明代理；
非透明代理；
透明的上游代理；
非透明的上游代理；


---

1. 透明代理
SimpleTransProxy.java

代理服务在收到连接请求时，判定：如果是CONNECT请求，需要回应代理连接成功消息到客户端；
CONNECT请求回应结束后，代理服务需要连接到CONNECT指定的远程服务器，然后直接转发客户端和远程服务通信；
代理服务在收到非CONNECT请求时，需要解析出请求的远程服务器，然后直接转发客户端和远程服务通信；

需要注意的点是：

通常HTTPS请求，在通过代理前，会发送CONNECT请求；连接成功后，会在信道上进行加密通信的握手协议；因此连接远程的时机是在CONNECT请求收到时，因为此后是加密数据；
透明代理在收到CONNECT请求时，不需要传递到远程服务（远程服务不识别此请求）；
透明代理在收到非CONNECT请求时，要无条件转发；

---

2  非透明代理


非透明代理，需要解析出客户端和远程服务端传输的内容，并做相应的处理。
当传输为HTTP协议时，SocketPipe传输的数据即为明文的数据，可以拦截后直接做处理。
当传输为HTTPS协议时，SocketPipe传输的有效数据为加密数据，并不能透明处理。
另外，无论是传输的HTTP协议还是HTTPS协议，SocketPipe读到的都为非完整的数据，需要做聚批的处理。
